---
title: "Project"
description: |
  Trying to do EDA
author:
  - name: Team 5 
    url: https://github.com/nxinyan/IS415_project
    affiliation: Singapore Management University
    affiliation_url: https://www.smu.edu.sg
date: "`r Sys.Date()`"
output: distill::distill_article
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, 
                      eval = TRUE,
                      message = FALSE,
                      warning = FALSE,
                      fig.retina = 3)
```

## Installing and Loading the R packages

```{r}
packages = c('maptools', 'sf', 'raster','spatstat', 'tmap','tidyverse','rgdal','ggplot2', 'ggthemes', 'plotly')
for (p in packages){
  if(!require(p, character.only = T)){
    install.packages(p)
  }
  library(p,character.only = T)
}
```


## Importing Geospatial Data

### Jakarta Layer

```{r echo=TRUE, eval=TRUE}
jakarta <- st_read(dsn = "data/Geospatial", 
                    layer = "BATAS_DESA_DESEMBER_2019_DUKCAPIL_DKI_JAKARTA")
```

Display basic information of the feature class

```{r echo=TRUE, eval=TRUE}
st_geometry(jakarta)
```

```{r echo=TRUE, eval=TRUE}
# Looking at the associated information in the dataframe
# glimpse(jakarta)
```

Identifying the different city in Jakarta

```{r echo=TRUE, eval=TRUE}
tmap_mode('view')
tm_shape(jakarta)+
  tm_polygons() +
tm_shape(jakarta) +
  tm_fill("KAB_KOTA",
          palette = "RdYlBu")+
  tm_borders()
```

Assigning EPSG code to a simple feature data frame

```{r}
st_crs(jakarta)
```

```{r}
jakarta23845 <- st_transform(jakarta, 
                              crs = 23845)
```

```{r}
st_crs(jakarta23845)
```

```{r}

```

```{r}

```

```{r}

```

```{r}

```

```{r}

```

### Airport Location

```{r}
airport = st_read(dsn = "data/airport", 
                  layer = "hotosm_idn_jakarta_airports_points")
```

Display basic information of the feature class

```{r}
st_geometry(airport)
```

```{r}
st_crs(airport)
```

```{r}
airport23845 <- st_transform(airport, 
                              crs = 23845)
```

```{r}
st_crs(airport23845)
```

```{r}
jakarta23845$`Airport_Count`<-lengths(st_intersects(jakarta23845, airport23845))
```

```{r}
summary(jakarta23845$`Airport_Count`)
```

```{r}
top_n(jakarta23845, 1, `Airport_Count`)
```

```{r}
jakarta23845$Area <- jakarta23845 %>%
  st_area()
```

```{r}
jakarta23845 <- jakarta23845 %>%
  mutate(`Airport_Density` = `Airport_Count`/Area * 1000000)
```

## Explorotary Data Analysis (EDA)

Looking at the distribution of Airport Density

```{r}
hist(jakarta23845$`Airport_Density`)
```

```{r}
ggplot(data=jakarta23845, 
       aes(x= as.numeric(`Airport_Density`)))+
  geom_histogram(bins=20, 
                 color="black", 
                 fill="light blue") +
  labs(title = "Are the airports evenly distributed in Indonesian?",
       subtitle= "There are many planning sub-zones with a single airport, on the other hand, \nthere are two planning sub-zones with at least 20 airports",
      x = "Airport density (per km sq)",
      y = "Frequency")
```

```{r}
head(airport23845)
```

```{r echo=TRUE, eval=TRUE}
ggplot(data = jakarta23845,
       aes(x = as.numeric(`Airport_Density`), 
                          y= as.numeric(`Airport_Count`)))+
  geom_point()+
  labs(x = "Airport density (per km sq)",
       y = "Airport count")
  coord_cartesian(xlim=c(0,40),
                  ylim = c(0,40))

```

```{r}
ggplot(data=jakarta23845, aes(x=`Airport_Count`)) +
  geom_histogram(bins=20, color="black", fill="light blue")
```

```{r}
jakarta23845 <- jakarta23845 %>%
  mutate(`LOG_Airport_Density` = log(Airport_Density))
```

```{r}
#ggplot(data=jakarta23845, aes(x=`LOG_Airport_Density`)) +
  #geom_histogram(bins=20, color="black", fill="light blue")
```

Plotting the location of airports

```{r}
tmap_mode("view")
tm_shape(jakarta)+
  tm_polygons() +
tm_shape(jakarta) +
  tm_fill("KAB_KOTA",
          palette = "RdYlBu")+
  tm_borders() +
tm_shape(airport) + 
  tm_dots()

tmap_mode("plot")
```

### No. of Birth

```{r}
birth <-'data/birth/IDN_births_pp_v2_2015.tif'
birth_raster = raster(birth)
```

```{r}
tmap_mode("view")
tm_shape(jakarta)+
  tm_polygons() +
tm_shape(jakarta) +
  tm_fill("KAB_KOTA",
          palette = "RdYlBu", alpha = 0.9)+
  tm_borders() +
tm_shape(birth_raster) + 
  tm_raster(palette = "Paired", alpha = 0.7)
tmap_mode("plot")
```

### Railway Lines

```{r}
railwaysline = st_read(dsn = "data/railways", layer = "hotosm_idn_jakarta_railways_lines")

uniquerail <- unique(railwaysline$name) 

railline <- railwaysline[!duplicated(railwaysline$name), ]
railline
```

```{r}
tmap_mode("view")
tm_shape(jakarta)+
  tm_polygons() +
tm_shape(jakarta) +
  tm_fill("KAB_KOTA",
          palette = "RdYlBu", alpha = 0.9)+
  tm_borders() +
tm_shape(railline) + 
  tm_dots() +
  tm_basemap("OpenStreetMap")
tmap_mode("plot")
```

```{r}
tmap_mode("view")
tm_shape(jakarta)+
  tm_polygons() +
tm_shape(jakarta) +
  tm_fill("KAB_KOTA",
          palette = "RdYlBu", alpha = 0.9)+
  tm_borders() +
tm_shape(railwaysline) + 
  tm_dots() +
  tm_basemap("OpenStreetMap")
tmap_mode("plot")
```

```{r}
railwaypoly = st_read(dsn = "data/railways", layer = "hotosm_idn_jakarta_railways_polygons")
```

```{r}
tmap_mode("view")
tm_shape(jakarta)+
  tm_polygons() +
tm_shape(jakarta) +
  tm_fill("KAB_KOTA",
          palette = "RdYlBu", alpha = 0.9)+
  tm_borders() +
tm_shape(railwaypoly) + 
  tm_dots() +
  tm_basemap("OpenStreetMap")
tmap_mode("plot")
```

### Healthcare Location

```{r}
healthcare = st_read(dsn = "data/health_facilities", layer = "IDN_hospital_point")
```

```{r}
st_crs(healthcare)
```

```{r}
healthcare <- st_transform(healthcare, crs = 23845)
```

```{r}
healthcare_dkijkt <- healthcare %>%
                      filter(Province == "DKI Jakarta") %>%
                      drop_na(District)
```

```{r}
healthcare_dkijkt$DistrictUpper = toupper(healthcare_dkijkt$District)

```

```{r}
healthcare_dkijkt[healthcare_dkijkt$DistrictUpper == "KOTA JAKARTA"] <- "JAKARTA"
```

```{r}
tmap_mode("view")
tm_shape(jakarta)+
  tm_polygons() +
tm_shape(jakarta) +
  tm_fill("KAB_KOTA",
          palette = "RdYlBu")+
  tm_borders() +
tm_shape(healthcare_dkijkt) + 
  tm_dots()
tmap_mode("plot")
```

### Points of Interests

```{r}
pointsofint = st_read(dsn = "data/points_of_interests", layer = "hotosm_idn_jakarta_points_of_interest_points")
```

```{r}
tmap_mode("view")
tm_shape(jakarta)+
  tm_polygons() +
tm_shape(jakarta) +
  tm_fill("KAB_KOTA",
          palette = "RdYlBu")+
  tm_borders() +
tm_shape(pointsofint) + 
  tm_dots()
tmap_mode("plot")
```

### Education

```{r}
education = st_read(dsn = "data/education", layer = "hotosm_idn_jakarta_education_facilities_points")
```

```{r}
tmap_mode("view")
tm_shape(jakarta)+
  tm_polygons() +
tm_shape(jakarta) +
  tm_fill("KAB_KOTA",
          palette = "RdYlBu")+
  tm_borders() +
tm_shape(education) + 
  tm_dots()
tmap_mode("plot")
```

```{r}

```

```{r}

```

```{r}

```

```{r}

```

```{r}

```

```{r}

```

```{r}

```

```{r}

```




